@model GPSInformation.Models.Evaluacion

@{
    ViewData["Title"] = "Responder";
    GPSInformation.Models.EvaluacionEmpleado Evaluacion = ViewBag.EvaluacionEmpleado;
}

<div class="d-sm-flex align-items-center justify-content-between">
    <div>
        <h2 class="mg-b-5">@Html.DisplayFor(model => model.Nombre)</h2>  <small>@Html.DisplayFor(model => model.PersonaName)</small>
        <p class="mg-b-0 tx-color-03">@Html.DisplayFor(model => model.InicioHora)<span>-</span>@Html.DisplayFor(model => model.FinHora)</p>
        <p class="mg-b-0 tx-color-03">@Html.DisplayFor(model => model.ModalidadName)</p>
    </div>
    <div class="mg-t-20 mg-sm-t-0">
        <button class="btn btn-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-printer mg-r-5"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg> Print</button>
        <button class="btn btn-white mg-l-5"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail mg-r-5"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg> Email</button>
        <button class="btn btn-primary mg-l-5"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-credit-card mg-r-5"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg> Pay</button>
    </div>
</div>
<hr />
@if (!Evaluacion.Respondio)
{

    <div id="AppEvaluacionRes" data-label="Preguntas" class="df-example demo-forms">
        <table class="table table-bordered table-hover">
            <tr>
                <th colspan="1" style="width: 60%;"></th>
                <th colspan="1" class="text-center">1</th>
                <th colspan="1" class="text-center">2</th>
                <th colspan="1" class="text-center">3</th>
                <th colspan="1" class="text-center">4</th>
                <th colspan="1" class="text-center">5</th>
            </tr>
            <tbody v-for="(seccion, indexSecccion) in Access">
                <tr>
                    <td colspan="6">{{ seccion.nombre }}</td>
                </tr>
                <tr v-for="(pregunta, indexPregunta) in seccion.preguntas">
                    <th colspan="1" style="width: 60%;">{{ pregunta.pregunta }}</th>
                    <td colspan="1" v-if="pregunta.tipo == 1" class="text-center">
                        <input type="radio" v-model="pregunta.respuesta.respuesta" value="1" />
                    </td>
                    <td colspan="1" v-if="pregunta.tipo == 1" class="text-center">
                        <input type="radio" v-model="pregunta.respuesta.respuesta" value="2" />
                    </td>
                    <td colspan="1" v-if="pregunta.tipo == 1" class="text-center">
                        <input type="radio" v-model="pregunta.respuesta.respuesta" value="3" />
                    </td>
                    <td colspan="1" v-if="pregunta.tipo == 1" class="text-center">
                        <input type="radio" v-model="pregunta.respuesta.respuesta" value="4" />
                    </td>
                    <td colspan="1" v-if="pregunta.tipo == 1" class="text-center">
                        <input type="radio" v-model="pregunta.respuesta.respuesta" value="5" />
                    </td>
                    <td colspan="5" v-if="pregunta.tipo == 2" class="text-center">
                        <textarea class="form-control" v-model="pregunta.respuesta.respuesta"></textarea>
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="form-group row mg-b-0">
            <div class="col-sm-12 text-right">
                <a asp-action="MisEvaluaciones" class="btn btn-sm btn-secondary">Cancelar</a>
                <button type="button" v-on:click="Save()" class="btn btn-sm btn-primary">Guardar evaluación</button>
            </div>
        </div>
    </div>
    @section Scripts {

        <script>
            $(document).ready(function () {

            });
        </script>
        <script>
        var AppEvaluacionRes = new Vue({
            el: "#AppEvaluacionRes",
            data: {
                Access: null

            },
            mounted() {
                this.Details();
            },
            methods: {
                Details: function () {
                    axios.get('@Url.Action("DataResponder","Evaluacion", new { id = Model.IdEvaluacion })', null, null).then(response => {
                        console.log(response.data)
                        this.Access = response.data;
                    }).catch(error => {
                        if (error.response) {
                            if (error.response.status === 400) {

                            }
                        }
                        console.error(error)
                        ShowMessageErrorShort("error al extraer información", "error")
                    }).finally()
                },
                Save: async function () {
                    let datos = {
                        IdEvaluacion : @Model.IdEvaluacion,
                        list : this.Access
                    }

                    console.log(datos)
                    await axios.post('@Url.Action("DataResponders", "Evaluacion")', datos, null).then(response => {
                        console.log(response.data)
                        this.Access = response.data;
                    }).catch(error => {
                        if (error.response) {
                            if (error.response.status === 400) {
                                ShowMessageErrorShort(error.response.data, "error")
                            }
                            if (error.response.status === 404) {
                                ShowMessageErrorShort(error.response.data, "error")
                            }
                        }
                        console.error(error)

                    }).finally()
                }
            }
        });
        </script>
    }
}
else
{
    <div class="alert alert-warning mg-b-0" role="alert">
        Esta evaluación ya ha sido respondida
    </div>
}

