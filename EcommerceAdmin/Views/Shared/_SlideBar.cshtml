@using Microsoft.AspNetCore.Http;
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@inject IHttpContextAccessor HttpContextAccessor

@{
    int USR_IdSplinnet = (int)HttpContextAccessor.HttpContext.Session.GetInt32("USR_IdSplinnet");
    int USR_IdArea = (int)HttpContextAccessor.HttpContext.Session.GetInt32("USR_IdArea");
    List<EcomDataProccess.Ecom_Pedido> ListEnvioCotizaciones = new List<EcomDataProccess.Ecom_Pedido>();
    List<EcomDataProccess.Ecom_Notificacion> Notificaciones = new List<EcomDataProccess.Ecom_Notificacion>();
    EcomDataProccess.EcomData EcomData_ = new EcomDataProccess.EcomData(System.Configuration.ConfigurationManager.AppSettings["Ecommerce_Database"].ToString(),System.Configuration.ConfigurationManager.AppSettings["Splinnet_Database"].ToString());

    if(USR_IdArea == 3)
    {
        EcomData_.Connect(EcomDataProccess.ServerSource.Splitnet);
        EcomDataProccess.Ecom_Usuario Ecom_Usuario = (EcomDataProccess.Ecom_Usuario)EcomData_.GetObject(EcomDataProccess.ObjectSource.Usuario);
        Ecom_Usuario.IdSplinnet = USR_IdSplinnet;
        Ecom_Usuario.GetIdSap();
        EcomData_.Disconect(EcomDataProccess.ServerSource.Splitnet);
        if(Ecom_Usuario.Id_sap.Count> 0)
        {
            Ecom_SAP Ecom_SAP = new Ecom_SAP("SAP");
            SAPDataProcess.SAP_BussinessPartner SAP_BussinessPartner = new SAPDataProcess.SAP_BussinessPartner(Ecom_SAP.SAP_DBConnection_);
            EcomData_.Connect(EcomDataProccess.ServerSource.Ecommerce);
            EcomDataProccess.Ecom_Pedido Ecom_Pedido_ = (EcomDataProccess.Ecom_Pedido)EcomData_.GetObject(EcomDataProccess.ObjectSource.Pedido);
            SAP_BussinessPartner.GetActivesBySalesEm(Ecom_Usuario.Id_sap).Where(bp => bp.IsActive && bp.IsActiveEcomerce).ToList().ForEach(bp => {
                Ecom_Pedido_.GetCotizacionParaEnvio(bp.CardCode).ForEach(doc =>
                {
                    ListEnvioCotizaciones.Add(doc);
                });
            });
            EcomData_.Disconect(EcomDataProccess.ServerSource.Ecommerce);
            Ecom_SAP.CloseConections();
        }
    }
    EcomData_.Connect(EcomDataProccess.ServerSource.Ecommerce);
    Notificaciones = EcomData_.getNotifications(USR_IdSplinnet,USR_IdArea);
}
<div class="br-header">
    <div class="br-header-left">
        <div class="navicon-left hidden-md-down"><a id="btnLeftMenu" href=""><i class="icon ion-navicon-round"></i></a></div>
        <div class="navicon-left hidden-lg-up"><a id="btnLeftMenuMobile" href=""><i class="icon ion-navicon-round"></i></a></div>
        <div class="input-group hidden-xs-down wd-170 transition"></div><!-- input-group -->
    </div><!-- br-header-left -->
    <div class="br-header-right">
        <nav class="nav">
            <div class="dropdown">
                <a href="" class="nav-link pd-x-7 pos-relative" data-toggle="dropdown">
                    <i class="icon ion-ios-bell-outline tx-24"></i>
                    <!-- start: if statement -->
                    <span class="square-8 bg-danger pos-absolute t-15 r-5 rounded-circle"></span>
                    <!-- end: if statement -->
                </a>
                <div class="dropdown-menu dropdown-menu-header wd-300 pd-0-force">
                    <div class="d-flex align-items-center justify-content-between pd-y-10 pd-x-20 bd-b bd-gray-200">
                        <label class="tx-12 tx-info tx-uppercase tx-semibold tx-spacing-2 mg-b-0">Notifications</label>
                        @*<a href="" class="tx-11">Mark All as Read</a>*@
                    </div><!-- d-flex -->
                    <div class="media-list">
                        <!-- loop starts here -->
                        @foreach (EcomDataProccess.Ecom_Pedido doc in ListEnvioCotizaciones)
                        {
                            <a href="@Url.Action("Detalle","Pedido",new {id = doc.DocNumEcommerce })" title="Ver cotización: @doc.DocNumEcommerce" class="media-list-link read">
                                <div class="media pd-x-20 pd-y-15">
                                    <img src="https://regalosparabebes.com.uy/wp-content/uploads/2018/08/icono-envios-en-el-dia.png" class="wd-40 rounded-circle" alt="">
                                    <div class="media-body">
                                        <p class="tx-13 mg-b-0 tx-gray-700"><strong class="tx-medium tx-gray-800">@doc.DocNumEcommerce</strong> Nueva solicitud de costos de envio</p>
                                        <span class="tx-12">@doc.DocDate</span>
                                    </div>
                                </div><!-- media -->
                            </a>
                        }
                        @foreach (EcomDataProccess.Ecom_Notificacion not in Notificaciones)
                        {
                            @if (not.Tipo == "info")
                            {
                                <a href="@Url.Action("InfoNotification","Sistema",new {id = not.Id })" title="Ver notificacion:" class="media-list-link @Html.Raw(not.Estatus == "Visto" ? "" : "read")">
                                    <div class="media pd-x-20 pd-y-15">
                                        <img src="https://regalosparabebes.com.uy/wp-content/uploads/2018/08/icono-envios-en-el-dia.png" class="wd-40 rounded-circle" alt="">
                                        <div class="media-body">
                                            <p class="tx-13 mg-b-0 tx-gray-700"><strong class="tx-medium tx-gray-800">@not.Ecom_Usuario_.Nombre @not.Ecom_Usuario_.ApellidoPaterno</strong> @not.Descripcion</p>
                                            <span class="tx-12">@not.Creacion</span>
                                        </div>
                                    </div><!-- media -->
                                </a>
                            }
                            else
                            {
                                <a href="#" title="Ver notificacion:" class="media-list-link @Html.Raw(not.Estatus == "Visto" ? "" : "read")">
                                    <div class="media pd-x-20 pd-y-15">
                                        <img src="https://regalosparabebes.com.uy/wp-content/uploads/2018/08/icono-envios-en-el-dia.png" class="wd-40 rounded-circle" alt="">
                                        <div class="media-body">
                                            <p class="tx-13 mg-b-0 tx-gray-700"><strong class="tx-medium tx-gray-800">@not.Ecom_Usuario_.Nombre @not.Ecom_Usuario_.ApellidoPaterno</strong> @not.Descripcion</p>
                                            <span class="tx-12">@not.Creacion</span>
                                        </div>
                                    </div><!-- media -->
                                </a>
                            }

                        }
                        <!-- loop ends here -->
                        <div class="pd-y-10 tx-center bd-t">
                            @*<a href="" class="tx-12"><i class="fa fa-angle-down mg-r-5"></i> Show All Notifications</a>*@
                        </div>
                    </div><!-- media-list -->
                </div><!-- dropdown-menu -->
            </div><!-- dropdown -->
            <div class="dropdown">
                <a href="" class="nav-link nav-link-profile" data-toggle="dropdown">
                    <span class="logged-name hidden-md-down">@HttpContextAccessor.HttpContext.Session.GetString("USR_Nombre") @HttpContextAccessor.HttpContext.Session.GetString("USR_ApellidoPaterno")</span>
                    <img src="http://192.168.2.29/FMX_V2/pages/fotos/@HttpContextAccessor.HttpContext.Session.GetString("USR_Foto")" class="wd-32 rounded-circle" alt="">
                    <span class="square-10 bg-success"></span>
                </a>
                <div class="dropdown-menu dropdown-menu-header wd-200">
                    <ul class="list-unstyled user-profile-nav">
                        <li><a href="@Url.Action("Logout","Login")"><i class="icon ion-power"></i> Sign Out</a></li>
                    </ul>
                </div><!-- dropdown-menu -->
            </div><!-- dropdown -->
        </nav>
    </div><!-- br-header-right -->
</div><!-- br-header -->